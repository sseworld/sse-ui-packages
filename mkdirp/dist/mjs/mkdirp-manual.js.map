{"version":3,"file":"mkdirp-manual.js","sourceRoot":"","sources":["../../src/mkdirp-manual.ts"],"names":[],"mappings":"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","sourcesContent":["import { dirname } from 'path'\r\nimport { MkdirpOptions, optsArg } from './opts-arg.js'\r\n\r\nexport const mkdirpManualSync = (\r\n  path: string,\r\n  options?: MkdirpOptions,\r\n  made?: string | undefined | void\r\n): string | undefined | void => {\r\n  const parent = dirname(path)\r\n  const opts = { ...optsArg(options), recursive: false }\r\n\r\n  if (parent === path) {\r\n    try {\r\n      return opts.mkdirSync(path, opts)\r\n    } catch (er) {\r\n      // swallowed by recursive implementation on posix systems\r\n      // any other error is a failure\r\n      const fer = er as NodeJS.ErrnoException\r\n      if (fer && fer.code !== 'EISDIR') {\r\n        throw er\r\n      }\r\n      return\r\n    }\r\n  }\r\n\r\n  try {\r\n    opts.mkdirSync(path, opts)\r\n    return made || path\r\n  } catch (er) {\r\n    const fer = er as NodeJS.ErrnoException\r\n    if (fer && fer.code === 'ENOENT') {\r\n      return mkdirpManualSync(path, opts, mkdirpManualSync(parent, opts, made))\r\n    }\r\n    if (fer && fer.code !== 'EEXIST' && fer && fer.code !== 'EROFS') {\r\n      throw er\r\n    }\r\n    try {\r\n      if (!opts.statSync(path).isDirectory()) throw er\r\n    } catch (_) {\r\n      throw er\r\n    }\r\n  }\r\n}\r\n\r\nexport const mkdirpManual = Object.assign(\r\n  async (\r\n    path: string,\r\n    options?: MkdirpOptions,\r\n    made?: string | undefined | void\r\n  ): Promise<string | undefined | void> => {\r\n    const opts = optsArg(options)\r\n    opts.recursive = false\r\n    const parent = dirname(path)\r\n    if (parent === path) {\r\n      return opts.mkdirAsync(path, opts).catch(er => {\r\n        // swallowed by recursive implementation on posix systems\r\n        // any other error is a failure\r\n        const fer = er as NodeJS.ErrnoException\r\n        if (fer && fer.code !== 'EISDIR') {\r\n          throw er\r\n        }\r\n      })\r\n    }\r\n\r\n    return opts.mkdirAsync(path, opts).then(\r\n      () => made || path,\r\n      async er => {\r\n        const fer = er as NodeJS.ErrnoException\r\n        if (fer && fer.code === 'ENOENT') {\r\n          return mkdirpManual(parent, opts).then(\r\n            (made?: string | undefined | void) => mkdirpManual(path, opts, made)\r\n          )\r\n        }\r\n        if (fer && fer.code !== 'EEXIST' && fer.code !== 'EROFS') {\r\n          throw er\r\n        }\r\n        return opts.statAsync(path).then(\r\n          st => {\r\n            if (st.isDirectory()) {\r\n              return made\r\n            } else {\r\n              throw er\r\n            }\r\n          },\r\n          () => {\r\n            throw er\r\n          }\r\n        )\r\n      }\r\n    )\r\n  },\r\n  { sync: mkdirpManualSync }\r\n)\r\n"]}